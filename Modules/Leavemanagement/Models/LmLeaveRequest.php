<?php/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. *//** * Description of AcdExaminationMarks * * @author ramesh */namespace Modules\Leavemanagement\Models;use Core\Model\Node;class LmLeaveRequest extends Node{    public $_studentId = NULL;    public $_admissionNo=NULL;    public $_academicYear=NULL;    public $_subject=NULL;     public $_message=NULL;     public $_leaveDate=NULL;     public $_endDate=NULL;     public function setStudentId($studentId) {        $this->_studentId = $studentId;        return $this;    }    public function getStudentId() {        return $this->_studentId;    }    public function setAdmissionNo($admissionNo) {        $this->_admissionNo = $admissionNo;        return $this;    }    public function getAdmissionNo() {        return $this->_admissionNo;    }    public function setAcademicyear($academicYear) {        $this->_academicYear = $academicYear;        return $this;    }    public function getAcademicyear() {        return $this->_academicYear;    }      public function setSubject($subject) {        $this->_subject = $subject;        return $this;    }    public function getSubject() {        return $this->_subject;    }      public function setLeaveDate($leaveDate) {        $this->_leaveDate = $leaveDate;        return $this;    }    public function getLeaveDate() {        return $this->_leaveDate;    }      public function setMessage($message) {        $this->_message = $message;        return $this;    }    public function getMessage() {        return $this->_message;    }      public function setEndDate($endDate) {        $this->_endDate = $endDate;        return $this;    }    public function getEndDate() {        return $this->_endDate;    }      public function leaveRequestData(){            $data=array();        $acdYearModel = \CoreClass::getModel("cur_list_academicyear");        $acdYearModel->setAcademicyear($this->getAcademicyear());        $yearoutput=$acdYearModel->getAcademicYearDetails();        $acdYearId=\Core::getValueFromArray($yearoutput, "AcdyearId");                $nodeModel = \CoreClass::getModel("student_admission");        $nodeModel->setStudentId($this->getStudentId());        $nodeModel->setAcademicyear($acdYearId);                $studentInfo=$nodeModel->getStudentinfo();          if(\Core::countArray($studentInfo)> 0){                        $data['user_type'] = "student";            $data['user_id'] = \Core::getValueFromArray($studentInfo, 'admission_no');            $data['name'] = \Core::getValueFromArray($studentInfo, 'name');            $data['cur_list_academicyear_id'] = \Core::getValueFromArray($studentInfo, 'cur_list_academicyear_id');            $data['list_branch_id'] = \Core::getValueFromArray($studentInfo, 'list_branch_id');            $data['cur_branch_orientation_id'] = \Core::getValueFromArray($studentInfo, 'cur_branch_orientation_id');            $data['cur_branch_class_id'] = \Core::getValueFromArray($studentInfo, 'cur_branch_class_id');            $data['cur_branch_class_section_id'] = \Core::getValueFromArray($studentInfo, 'cur_branch_class_section_id');            $data['subject'] = $this->getSubject();            $data['description'] = $this->getMessage();            $data['leave_date'] = $this->getLeaveDate();            $data['end_date'] = $this->getLeaveDate();            $data['lm_leave_status_id'] = "PEN";             $node = \CoreClass::getController("lm_leave_request");            $node->setNodeName('lm_leave_request');            $node->setMethodType("POST");            $node->setScriptAction();            $node->setRequestedData($data);            $result = $node->addAction();             if (\Core::getValueFromArray($result, "status") == "success") {                $output['status']='success';                $output['message']="Your Request Is Pending For Approvel";            }else{                $output['status']=error;                $output['message']="Try Agin";            }                     }                 return $output;    }     public function leaveRequestList(){            $data=array();        $acdYearId=$this->getAcademicyear();        $nodeModel = \CoreClass::getModel($this->_nodeName);        $nodeModel->setNodeName($this->_nodeName);           $nodeModel->addCustomFieldToSelect("lm_leave_request.id", "id");          $nodeModel->addCustomFieldToSelect("lm_leave_request.subject", "subject");        $nodeModel->addCustomFieldToSelect("lm_leave_request.description", "description");        $nodeModel->addCustomFieldToSelect("lm_leave_request.leave_date", "leave_date");        $nodeModel->addCustomFieldToSelect("lm_leave_request.end_date", "end_date");           $nodeModel->addCustomFieldToSelect("lm_leave_status.name", "status");           $nodeModel->addCustomJoin("lm_leave_status.id", "lm_leave_status", "lm_leave_status", "lm_leave_status.short_code=lm_leave_request.lm_leave_status_id");        $nodeModel->addCustomFilter("lm_leave_request.cur_list_academicyear_id='" . $acdYearId . "' ");        $nodeModel->addCustomFilter("lm_leave_request.user_id='" . $this->getAdmissionNo() . "' ");                $nodeModel->getCollection();        $output = $nodeModel->_collections;          return $output;            }}