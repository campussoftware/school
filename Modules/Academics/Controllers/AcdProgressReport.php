<?php/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. *//** * Description of AcdProgressReport * * @author ramesh */namespace Modules\Academics\Controllers;use Core\Controllers\NodeController;class Acdprogressreport extends NodeController{    //put your code here        public function getProgressReportAction()    {        $wb=new \Core\WebsiteSettings();                $requestdata=$this->_requestedData;                  $list_academicyear_id=\Core::getValueFromArray($requestdata, "cur_list_academicyear_id");        $list_barnch_id=\Core::getValueFromArray($requestdata, "list_branch_id");        $branch_orientation_id=\Core::getValueFromArray($requestdata, "cur_branch_orientation_id");        $branch_class_id=\Core::getValueFromArray($requestdata, "cur_branch_class_id");        $branch_class_section_id=\Core::getValueFromArray($requestdata, "cur_branch_class_section_id");        $acd_exam_group_id=\Core::getValueFromArray($requestdata, "acd_exam_group_id");        $admission_no=\Core::getValueFromArray($requestdata, "admision_no");                        $listBranchModel = \CoreClass::getModel("list_branch");        $listBranchModel->setBranchId($list_barnch_id);        $orgnization_details=$listBranchModel->branchDetails();                $resulttemplte=null;		$orgimage= $wb->websiteUrl.$wb->documentRootUpload."/".\Core::getValueFromArray($orgnization_details, "logo");	$organitionlogo='<img src="'.$orgimage.'">';	                        $examGroupModel = \CoreClass::getModel("acd_exam_group");        $examGroupModel->setexamGroupId($acd_exam_group_id);        $examgroupdetails=$examGroupModel->examGroupDetails();                        $examgroupname=\Core::getValueFromArray($examgroupdetails, "name");	$template=\Core::getValueFromArray($examgroupdetails, "template");        	$template=str_replace("{ORGANIZATIONLOGO}",$organitionlogo,$template);	$template=str_replace("{ORGANIZATIONNAME}",strtoupper(\Core::getValueFromArray($orgnization_details, "orgname")),$template);	$template=str_replace("{BRANCH}",strtoupper(\Core::getValueFromArray($orgnization_details, "branch")),$template);                  $branchModel = \CoreClass::getModel("cur_branch_orientation");        $branchModel->setBranchOrientation($branch_orientation_id);        $course=$branchModel->branchOrineationDetails();                        $branchclassModel = \CoreClass::getModel("cur_branch_class");        $branchclassModel->setBranchClass($branch_class_id);        $classname=$branchclassModel->branchClassDetails();                $nodeModel = \CoreClass::getModel("cur_class_subject");        $nodeModel->setClassId(\Core::getValueFromArray($classname, "classId"));        $subjectname=$nodeModel->classSubjectDetails();        foreach ($subjectname as $key => $subjectvalue) {            $subjectname_array[\Core::getValueFromArray($subjectvalue, "id")]=\Core::getValueFromArray($subjectvalue, "name");        }             	$template=str_replace("{COURSE}",strtoupper(\Core::getValueFromArray($course, "name")),$template);                $template=str_replace("{CLASS}",strtoupper(\Core::getValueFromArray($classname, "name")),$template);        	$fmwhere=null;        $nodeModel = \CoreClass::getModel("acd_final_marks");        $nodeModel->setBranchClass($branch_class_id);        $nodeModel->setexamGroupId($acd_exam_group_id);        $nodeModel->setSectionId($branch_class_section_id);        $nodeModel->setAdmissionNo($admission_no);        $finalmarks=$nodeModel->getFinalMarksDetails();                $db=new \Core\DataBase\ProcessQuery();        $db->setTable("acd_subgroupexams");        $db->addFieldArray(array("acd_examination_schedule_id"=>"examination_shedule_id"));        $db->addFieldArray(array("percentage"=>"percentage"));        $db->addWhere("acd_exam_group_id='".$acd_exam_group_id."'");	$subexamgroupdetails=$db->getRows("examination_shedule_id","percentage");	if(!is_array($subexamgroupdetails))	{	    $subexamgroupdetails=array();	}	$totalexamgroupdeails=$subexamgroupdetails;                         $nodeModel = \CoreClass::getModel("acd_examination_schedule");        $nodeModel->setClassId(\Core::getValueFromArray($classname, "classId"));        $examname=$nodeModel->ExamShedule();        foreach ($examname as $key => $examvalue) {            $examnamearray[\Core::getValueFromArray($examvalue, "id")]=\Core::getValueFromArray($examvalue, "name");        }                                          $nodeModel = \CoreClass::getModel("cur_branch_class_section");        $nodeModel->setBranchClass($branch_class_id);        $sectionDetails=$nodeModel->SectionDetails();        foreach ($sectionDetails as $key => $sectionValue) {            $section_array[\Core::getValueFromArray($sectionValue, "id")]=\Core::getValueFromArray($sectionValue, "name");        }                  if(\Core::countArray($finalmarks)>0){            $nodeModel = \CoreClass::getModel("acd_studentmarks_details");            $nodeModel->setAcademicyear($list_academicyear_id);            $nodeModel->setBranchClass($branch_class_id);            $nodeModel->setSectionId($branch_class_section_id);            $nodeModel->setAdmissionNo($admission_no);            $student_marks_details=$nodeModel->studentMarksDetails();                        $studentmarksdetails=array();             $subjectList=[];            $examschuleList=[];	    if(count($student_marks_details)>0)	    {		foreach($student_marks_details as $smd)		{		    $studentmarksdetails[$smd['admission_no']][$smd['class_subject_id']][$smd['esid']]['max_marks']=$smd['max_marks'];		    $studentmarksdetails[$smd['admission_no']][$smd['class_subject_id']][$smd['esid']]['obtained_marks']=$smd['obtained_marks'];		    $studentmarksdetails[$smd['admission_no']][$smd['class_subject_id']][$smd['esid']]['attendance_status_id']=$smd['attendance_status_id'];		    $studentmarksdetails[$smd['admission_no']][$smd['class_subject_id']][$smd['esid']]['grade']=$smd['grade'];		    $studentmarksdetails[$smd['admission_no']][$smd['class_subject_id']][$smd['esid']]['gradepoints']=$smd['gradepoints'];		    $studentmarksdetails[$smd['admission_no']][$smd['class_subject_id']][$smd['esid']]['remarks']=$smd['remarks'];                    $subjectList[$smd['class_subject_id']]=$smd['class_subject_id'];                    $examschuleList[$smd['esid']]=$smd['esid'];		}            $k=1;	    foreach($finalmarks as $admission_no=>$studentdata)	    {		$temp=str_replace("{ADMISSIONNO}",$admission_no,$template);		$temp=str_replace("{NAME}",\Core::getValueFromArray($studentdata, name),$temp);		$temp=str_replace("{EXAMNAME}",$examgroupname,$temp);		$temp=str_replace("{SECTION}",$section_array[\Core::getValueFromArray($studentdata, "cur_branch_class_section_id")],$temp);                		$list=explode('<!--<rhead>-->',$temp);		$temphead=$list['0'];		$list1=explode('<!--</rhead>-->',$list['1']);		$examheader=$list1['0'];		$examheaderlist=explode('<!--<exnamelist>-->',$examheader);		$examheader=$examheaderlist['0'];		$examfooter=explode('<!--</exnamelist>-->',$examheaderlist['1']);		//exnamelist		$exnametemp=$examfooter['0'];                if(\Core::countArray($subexamgroupdetails)>0){                                        foreach($subexamgroupdetails as $esid=>$per)		    {                        $examheader.=str_replace("{ENAME}",$examnamearray[$esid],$exnametemp);		    }                }                		               		if(count($mainexamgroupdeails)>0)		{		    foreach($mainexamgroupdeails as $esid=>$per)		    {			$examheader.=str_replace("{ENAME}",$examnamearray[$esid],$exnametemp);		    }		}		$examheader.=$examfooter['1'];		$temp=$list1['1'];		$list=explode('<!--<data>-->',$temp);		$temp=$list['0'];		$list1=explode('<!--</data>-->',$list['1']);		$temp1=$list1['0'];		$examinationmarksdetails_temp=$studentmarksdetails[$admission_no];                 		foreach($subjectList as $subject)		{                        $studentmarksdetails_temp=$examinationmarksdetails_temp[$subject];                   		    $subjectname=$subjectname_array[$subject];		    $maxmarks="";		    $opmarks="";		    $examdatalist=explode('<!--<exrs>-->',$temp1);		    $examdatahead=$examdatalist['0'];		    $examdatalist=explode('<!--</exrs>-->',$examdatalist['1']);		    $exdatatemp=$examdatalist['0'];		    $subjecttemp="";                    foreach ($examschuleList as $esid)                    {                        $subjectdata=$studentmarksdetails_temp[$esid];                   			$subjecttemp.=str_replace(array("{OBTAINEDMARKS}","{MM}","{GRADE}"),array($subjectdata['obtained_marks'],$subjectdata['max_marks'],$subjectdata['grade']),$exdatatemp);			$maxmarks+=$subjectdata['max_marks'];                       			if($subjectdata['obtained_marks']!="" || $subjectdata['obtained_marks']=="0")			{			    $opmarks+=$subjectdata['obtained_marks'];			}				    }		    $temp.=str_replace(array('{SUBJECTNAME}','{MM}')					   ,array($subjectname,$maxmarks),$examdatahead);		    $temp.=$subjecttemp;		    $temp.=str_replace(array('{MAXMARKS}','{OBTAINEDMARKS}','{STOTAL}','{GRADE}','{GRADEPOINTS}','{REMARKS}')					   ,array($maxmarks,$opmarks,$opmarks,$subjectdata['grade'],$subjectdata['gradepoints'],$subjectdata['remarks']),$examdatalist['1']);		}				$i=1;		$temp.=$list1['1'];		$studenttemplate=$temphead.$examheader.$temp;		$studenttemplate=str_replace(array('{GRANDTOTAL}','{FINALGRADE}','{GPA}')				  ,array($studentdata['total_optianed'],$studentdata['grade'],$studentdata['gradepoints']),$studenttemplate);		$studenttemplate=str_replace(array('{OVERALLREMARKS}'),array($studentdata['remarks']),$studenttemplate);		$resulttemplte.=$studenttemplate;		if(count($finalmarks)!=$k)		{		    $resulttemplte.='<div style="page-break-before: always;">&nbsp</div>';		}		$k++;		    }                                        	    }                    }                 echo $resulttemplte;    }    }