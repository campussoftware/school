<?php/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. *//** * Description of AcdExaminationMarks * * @author ramesh */namespace Modules\Attendencereport\Controllers;use Core\Controllers\NodeController;class AcdStudentAttendance extends NodeController {    public function AcdStudentAttendanceAfterDataUpdate() {        if ($this->_currentAction == 'add') {            $requestedData = $this->_requestedData;             $db = new \Core\DataBase\ProcessQuery();            $db->setTable("student_history", "sh");            $db->addFieldArray(array("sd.name" => "name"));            $db->addField("sh.*");            $db->addJoin("student_admission_id", "student_admission", "sd", "sd.id=sh.student_admission_id");            $db->addWhere("fee_list_feegroup_id='TAD'");            $db->addWhere("cur_list_academicyear_id='" . $requestedData['cur_list_academicyear_id'] . "'");            $db->addWhere("list_branch_id='" . $requestedData['list_branch_id'] . "'");            $db->addWhere("cur_branch_orientation_id='" . $requestedData['cur_branch_orientation_id'] . "'");            $db->addWhere("cur_branch_class_id='" . $requestedData['cur_branch_class_id'] . "'");            $db->addWhere("cur_branch_class_section_id='" . $requestedData['cur_branch_class_section_id'] . "'");            $db->addWhere("student_status_id in('NW','EX')");            $db->buildSelect();            $studentDetails = $db->getRows();                       if (\Core::countArray($studentDetails) > 0) {                $db = new \Core\DataBase\ProcessQuery();                $db->setTable("core_attendance_status");                $db->addField("short_code");                $db->addWhere("short_code='Present'");                $core_attendance_status_id = $db->getValue();                foreach ($studentDetails as $studentData) {                         $node = new \Core\Model\NodeSave();                        $node->setNode("acd_student_attendance_details");                        $node->setData("acd_student_attendance_id", $requestedData['id']);                        $node->setData("cur_list_academicyear_id", $requestedData['cur_list_academicyear_id']);                        $node->setData("list_branch_id", $requestedData['list_branch_id']);                        $node->setData("cur_branch_orientation_id", $requestedData['cur_branch_orientation_id']);                        $node->setData("cur_branch_class_id", $requestedData['cur_branch_class_id']);                        $node->setData("cur_branch_class_section_id", $requestedData['cur_branch_class_section_id']);                        $node->setData("student_admission_id", $studentData['student_admission_id']);                        $node->setData("admission_no", $studentData['admission_no']);                        $node->setData("name", $studentData['name']);                        $node->setData("cur_list_attendancefrequency_id", $requestedData['cur_list_attendancefrequency_id']);                        $node->setData("core_attendance_status_id", $core_attendance_status_id);                        $node->save();                }            }        }    }}